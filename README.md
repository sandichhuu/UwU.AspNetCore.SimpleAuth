# UwU.AspNetCore.SimpleAuth
* Simple secret key compare middleware for web service ASP.NET Core.
* Based on .netstandard2.0, support wide range project types.
* Use System.Security.Cryptography for anti timing attack.

# Security Warning
* SimpleAuth is design only server-server connection, not for server-client purpose (working but should not use this way)
* The right way for server-client is: Login -> Got Token -> Authenticate with tokken -> Cookies.

# Getting Started

1. Download dll from github release page: [Download](https://github.com/sandichhuu/UwU.AspNetCore.SimpleAuth/releases/tag/stable)
2. Put downloaded dll file on project folder.
3. Import/References dll to ASP.NET Web API project.
- Right click on project **Dependencies**, choose **Add Project Reference...**.
- Click **Browse...**
- Then navigate to downloaded dll.

# Configuration
1. Open and edit **appsettings.json** file. Key is what ever you want, default is HUB_SECRET_KEY.
```json
{
  "HUB_SECRET_KEY": "your secret key here, longer is better",
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
```

2. Open and edit Programs.cs
```csharp
public class Program
{
    public static void Main(string[] args)
    {
        var builder = WebApplication.CreateBuilder(args);
        builder.Services.AddSignalR();

        // Add SimpleAuth to reading key stored on appsettings.json.
        builder.AddSimpleAuth("HUB_SECRET_KEY", CryptographicOperations.FixedTimeEquals);

        var app = builder.Build();

        // Make it work
        app.UseSimpleAuth();

        app.MapHub<ChatHub>("chat");
        app.Run();
    }
}
```

# Advanced
1. Only use for **/chat** route, another route will not be applied.
```csharp
app.UseSimpleAuth(["chat"]); // Only apply chat route.

// app.UseSimpleAuth(); apply to all routes.
// app.UseSimpleAuth(["chat", "api", "whatever"]); apply to multiple routes.
```

# Example SignalR client on Console app (generated by GPT-OSS-120B)
```csharp
static async Task Main(string[] args)
{
    var hubUrl = $"http://localhost:5266/chat?secret={Uri.EscapeDataString("your secret key here, must match with server")}";

    var connection = new HubConnectionBuilder()
        .WithUrl(hubUrl)
        .Build();

    connection.On<string, string>("ReceiveMessage", (user, msg) =>
        Console.WriteLine($"[{user}] {msg}"));

    try
    {
        await connection.StartAsync();
        Console.WriteLine("üöÄ Connected");
        await connection.InvokeAsync("SendMessage", "client1", "Hello from .NET client");
    }
    catch (Exception ex)
    {
        Console.WriteLine($"‚ùå Connection failed: {ex.Message}");
    }

    Console.ReadLine();
    await connection.StopAsync();
}
```

# Protect secret key on client.
* On the case store secret key on client code, use publishAOT or obfuscator to hide it.
* DO NOT USE THIS WAY IF PROJECT IS PRODUCTION.

# Need help ?
Connect with me: [Discord](https://discordapp.com/users/562144050304516150) #sandichhuu

# Policy
This project is released into the public domain: you may use, copy, modify, and distribute it for any purpose, including commercial use without any legal restrictions or attribution requirements.
